<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Health Articles - Healthcare App</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>

<body>
  <header>
    <div class="logo">
      <img src="images/logo.png" alt="Healthcare Logo" />
    </div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="departments.html">Departments</a></li>
        <li><a href="doctors.html">Doctors</a></li>
        <li><a href="appointment.html">Make Appointment</a></li>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li id="logout-link">Logout</li>
      </ul>
    </nav>
  </header>

  <main class="articles">
    <h1>Health Articles</h1>

    <!-- Editor Section (Visible only to doctors) -->
    <div id="articleEditor" style="display: none;">
      <h2>Create New Article</h2>
      <form id="createArticleForm">
        <div class="form-group">
          <label for="articleTitle">Title:</label>
          <input type="text" id="articleTitle" required>
        </div>
        <div class="form-group">
          <label for="articleContent">Content:</label>
          <textarea id="articleContent" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Publish Article</button>
      </form>
    </div>

    <!-- Articles List -->
    <div id="articlesList">
      <!-- Articles will be populated here via JavaScript -->
    </div>
  </main>

  <footer>
    &copy; 2023 Healthcare App. All rights reserved.
  </footer>

  <script>
    // Check user role from session storage
    const userRole = sessionStorage.getItem('userRole');
    const isLoggedIn = sessionStorage.getItem('isLoggedIn') === 'true';
    const username = sessionStorage.getItem('username');

    // Articles data (would typically come from a database)
    let articles = JSON.parse(localStorage.getItem('articles')) || [
      {
        id: 1,
        title: "Maintaining Heart Health",
        content: "A deep dive into how lifestyle choices affect your heart and wellbeing.",
        author: "Dr. Emily Johnson",
        date: "2023-10-12",
        likes: 42
      },
      {
        id: 2,
        title: "Understanding Neurological Disorders",
        content: "Insightful information to recognize the early signs and symptoms.",
        author: "Dr. Jane Smith",
        date: "2023-10-10",
        likes: 28
      },
      {
        id: 3,
        title: "Effective Management of Diabetes",
        content: "Guidance on diet, medication, and lifestyle changes needed for diabetic patients.",
        author: "Dr. John Doe",
        date: "2023-10-05",
        likes: 35
      }
    ];

    document.addEventListener('DOMContentLoaded', function () {
      // Show/hide editor based on user role
      const articleEditor = document.getElementById('articleEditor');
      if (userRole === 'doctor' && isLoggedIn) {
        articleEditor.style.display = 'block';
      }

      // Display existing articles
      renderArticles();

      // Handle logout
      document.getElementById('logout-link').addEventListener('click', () => {
        sessionStorage.clear();
        alert('Logged out successfully!');
        window.location.href = 'index.html';
      });

      // Handle form submission
      document.getElementById('createArticleForm')?.addEventListener('submit', createArticle);
    });

    function renderArticles() {
      const articlesList = document.getElementById('articlesList');
      articlesList.innerHTML = '';

      if (articles.length === 0) {
        articlesList.innerHTML = '<p>No articles found.</p>';
        return;
      }

      articles.forEach(article => {
        const articleElement = document.createElement('article');
        articleElement.innerHTML = `
          <h3>${article.title}</h3>
          <p>${article.content}</p>
          <div class="article-footer">
            <span class="article-author">By ${article.author}</span>
            <span class="article-date">Published ${article.date}</span>
            <div class="article-actions">
              ${userRole !== 'doctor' ?
            `<button class="btn-like" onclick="likeArticle(${article.id})">üëç Like (${article.likes})</button>` :
            `<button class="btn-edit" onclick="editArticle(${article.id})">‚úèÔ∏è Edit</button>
                 <button class="btn-delete" onclick="deleteArticle(${article.id})">üóëÔ∏è Delete</button>`}
            </div>
          </div>
        `;
        articlesList.appendChild(articleElement);
      });
    }

    function createArticle(e) {
      e.preventDefault();

      const title = document.getElementById('articleTitle').value;
      const content = document.getElementById('articleContent').value;

      const newArticle = {
        id: Date.now(),
        title,
        content,
        author: `Dr. ${username}`,
        date: new Date().toISOString().split('T')[0],
        likes: 0
      };

      articles.unshift(newArticle);
      localStorage.setItem('articles', JSON.stringify(articles));

      document.getElementById('createArticleForm').reset();
      renderArticles();
    }

    function editArticle(id) {
      const article = articles.find(a => a.id === id);
      if (article) {
        document.getElementById('articleTitle').value = article.title;
        document.getElementById('articleContent').value = article.content;

        // Remove the old article
        articles = articles.filter(a => a.id !== id);
        localStorage.setItem('articles', JSON.stringify(articles));
      }
    }

    function deleteArticle(id) {
      if (confirm('Are you sure you want to delete this article?')) {
        articles = articles.filter(a => a.id !== id);
        localStorage.setItem('articles', JSON.stringify(articles));
        renderArticles();
      }
    }

    function likeArticle(id) {
      const article = articles.find(a => a.id === id);
      if (article) {
        article.likes++;
        localStorage.setItem('articles', JSON.stringify(articles));
        renderArticles();
      }
    }
  </script>
</body>

</html>